# Dev mode override: Vite HMR + Nginx API proxy
# Nginx handles API routing on :8100 (for MCP tools + dashboard)
# Vite provides frontend HMR on :5173 (for UI development)

services:
  # Keep Nginx frontend for API routing (serves built SPA + proxies API)
  # No profile override — it runs in both dev and production

  # Core no longer exposed directly — Nginx proxies to it
  # (remove the port mapping that was bypassing Nginx)

  # Vite dev server with HMR (for frontend development)
  claude-mem-vite:
    image: node:20-slim
    container_name: claude-mem-vite
    working_dir: /app
    command: ["sh", "-c", "npm install --legacy-peer-deps && npm run dev -- --host 0.0.0.0"]
    ports:
      - "5173:5173"
    volumes:
      - ./frontend:/app
      - vite_node_modules:/app/node_modules
    environment:
      - TZ=Asia/Bangkok
    depends_on:
      claude-mem-core:
        condition: service_healthy

volumes:
  vite_node_modules:
